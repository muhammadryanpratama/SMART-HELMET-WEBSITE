<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Fleet // Command</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="style.css">
</head>
<body class="fade-in">

  <div id="loader" style="position:fixed; inset:0; background:#020617; z-index:99999; display:flex; justify-content:center; align-items:center; flex-direction:column;">
    <i class="fa-solid fa-circle-notch fa-spin" style="font-size:3rem; color:#3b82f6; margin-bottom:20px;"></i>
    <p style="color:#94a3b8; letter-spacing:2px; font-family:'JetBrains Mono'">SYNCING DATABASE...</p>
  </div>

  <header>
    <div class="brand">
      <i class="fa-solid fa-layer-group"></i>
      <span>SMART FLEET</span>
    </div>
    
    <div class="header-controls">
      <div class="weather-widget">
        <span id="weatherIcon" class="weather-icon"><i class="fa-solid fa-cloud-sun"></i></span>
        <span id="weatherTemp">24°C</span>
        <span style="font-weight:400; font-size:0.8rem; margin-left:5px;">Bandung</span>
      </div>

      <div class="sys-batt" id="sysBatt" title="System Power">
        <i class="fa-solid fa-plug"></i> <span>AC</span>
      </div>
      <button class="theme-btn" onclick="toggleTheme()">
        <i class="fa-solid fa-circle-half-stroke"></i>
      </button>
      <div style="font-family:'JetBrains Mono'; font-weight:700; color:var(--primary);" id="clock">00:00</div>
    </div>
  </header>

  <div class="main-layout">
    <aside>
      <div class="stat-card">
        <span class="stat-title">Total Fleet</span>
        <span class="stat-value" id="totalCount">0</span>
      </div>
      <div class="stat-card" style="border-left: 4px solid var(--success);">
        <span class="stat-title">Safe Condition</span>
        <span class="stat-value" style="color:var(--success)" id="safeCount">0</span>
      </div>
      <div class="stat-card" style="border-left: 4px solid var(--warning);">
        <span class="stat-title">Attention Needed</span>
        <span class="stat-value" style="color:var(--warning)" id="warningCount">0</span>
      </div>
      <div class="stat-card" style="border-left: 4px solid var(--danger);">
        <span class="stat-title">Critical Alerts</span>
        <span class="stat-value" style="color:var(--danger)" id="criticalCount">0</span>
      </div>
      
      <div class="about-link" onclick="openAbout()">
        <i class="fa-solid fa-circle-info"></i> About System
      </div>
    </aside>

    <div class="content">
      <div class="toolbar">
        <div style="display:flex; gap:10px; align-items:center;">
          <input type="text" id="searchInput" class="search-input" placeholder="Search ID or Name...">
          <select id="sortSelect" class="sort-select" onchange="handleSort()">
            <option value="ID_ASC">ID (1-100)</option>
            <option value="ID_DESC">ID (100-1)</option>
            <option value="NAME_ASC">Name (A-Z)</option>
            <option value="NAME_DESC">Name (Z-A)</option>
          </select>
        </div>

        <div style="display:flex; gap:10px;">
          <button class="btn btn-add" onclick="openAddModal()"><i class="fa-solid fa-plus"></i> Add Unit</button>
          <button class="btn active filter-btn" data-filter="ALL" onclick="setFilter('ALL')">All</button>
          <button class="btn filter-btn" data-filter="CRITICAL" onclick="setFilter('CRITICAL')" style="color:var(--danger); border-color:var(--danger)">Critical</button>
        </div>

        <div style="display:flex; gap:10px;">
          <button class="btn" onclick="exportData()"><i class="fa-solid fa-file-excel"></i> Excel</button>
          <button class="btn active view-btn" id="btnGrid" onclick="switchView('GRID')"><i class="fa-solid fa-users"></i> Workers</button>
          <button class="btn view-btn" id="btnMap" onclick="switchView('MAP')"><i class="fa-solid fa-map-location-dot"></i> Map</button>
        </div>
      </div>

      <div id="gridArea" class="grid-container"></div>

      <div id="mapArea" class="map-container">
        <div class="map-radar"><div class="radar-sweep"></div></div>
        
        <div id="mainMap"></div>
        <div id="mapPopup" class="map-popup-custom">
           <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
              <span id="mpId" style="font-weight:bold; color:var(--primary); font-family:'JetBrains Mono'">ID</span>
              <span onclick="closeMapPopup()" style="cursor:pointer; font-size:1.2rem;">&times;</span>
           </div>
           <div id="mpName" style="margin-bottom:15px; font-weight:600;">Name</div>
           <div style="display:flex; justify-content:space-between; font-size:0.9rem;">
              <span><i class="fa-solid fa-temperature-half" style="color:#ef4444"></i> <b id="mpTemp">--</b></span>
              <span><i class="fa-solid fa-battery-half" style="color:#10b981"></i> <b id="mpBatt">--</b></span>
           </div>
        </div>
      </div>

      <div class="pagination" id="pagArea">
        <span style="font-size:0.85rem; color:var(--text-muted)">
          Page <b id="currPage" style="color:var(--text-main)">1</b> of <b id="totalPage">1</b>
        </span>
        <div style="display:flex; gap:8px;">
          <button class="page-btn" id="prevBtn" onclick="changePage(-1)"><i class="fa-solid fa-chevron-left"></i></button>
          <button class="page-btn" id="nextBtn" onclick="changePage(1)"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="addModal">
    <div class="modal-card" style="max-width: 450px;">
      <h2 style="margin-bottom:10px;">Add New Unit</h2>
      <div class="input-group">
        <label style="color:var(--text-muted); display:block; margin-bottom:8px; font-size:0.8rem;">Worker Full Name</label>
        <input type="text" id="newWorkerName" class="modal-input" placeholder="e.g. Budi Santoso">
      </div>
      <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:20px;">
        <button class="btn" onclick="closeAddModal()">Cancel</button>
        <button class="btn btn-add" onclick="submitNewWorker()">Confirm Add</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="detailModal">
    <div class="modal-card">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
         <div>
           <h2 id="mId" style="font-family:'JetBrains Mono'; color:var(--text-muted); font-size:1rem; margin-bottom:5px;">ID</h2>
           <div id="mName" style="font-weight:700; font-size:1.5rem;">Name</div>
         </div>
         <button onclick="closeDetailModal()" style="background:none; border:none; color:var(--text-muted); cursor:pointer; font-size:2rem;">&times;</button>
      </div>
      
      <div style="display:grid; grid-template-columns: 2fr 1fr; gap:30px;">
         <div>
           <canvas id="mChart" style="height:250px; width:100%; margin-bottom:20px;"></canvas>
           <div style="display:flex; gap:20px;">
             <div class="stat-card" style="flex:1;">
               <span class="stat-title">Temp</span>
               <div style="display:flex; align-items:center; gap:10px; margin-top:5px;">
                  <i class="fa-solid fa-temperature-half" style="color:#ef4444"></i>
                  <span class="stat-value" id="mTemp">--</span>
               </div>
             </div>
             <div class="stat-card" style="flex:1;">
               <span class="stat-title">Battery</span>
               <div style="display:flex; align-items:center; gap:10px; margin-top:5px;">
                  <i class="fa-solid fa-battery-half" style="color:#10b981"></i>
                  <span class="stat-value" id="mBatt">--</span>
               </div>
             </div>
           </div>
         </div>
         <div style="height:350px; background:#000; border-radius:12px; overflow:hidden; border:1px solid var(--border);">
           <div id="detailMap" style="width:100%; height:100%;"></div>
         </div>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="aboutModal">
    <div class="modal-card" style="max-width:600px;">
      <div style="text-align:center; margin-bottom:25px;">
        <i class="fa-solid fa-shield-halved" style="font-size:3rem; color:var(--primary);"></i>
        <h2 style="margin-top:15px; color:var(--text-main);">SMART FLEET SYSTEM</h2>
        <p style="color:var(--text-muted); font-size:0.9rem;">Sector 7 Industrial Monitoring Solution</p>
      </div>
      
      <div class="about-text" style="line-height:1.7; color:var(--text-muted); margin-bottom:25px; text-align:left;">
        <h3 style="color:var(--text-main); margin-bottom:5px;">Mission Objective</h3>
        <p>
          To provide comprehensive real-time situational awareness for industrial field operations. 
          The Smart Fleet system ensures worker safety through continuous biometric monitoring and geolocation tracking.
        </p>
        
        <h3 style="color:var(--text-main); margin-bottom:5px;">Core Capabilities</h3>
        <p>
          • <strong>Telemetry:</strong> Live temperature and battery health monitoring.<br>
          • <strong>Geofencing:</strong> Precision GPS tracking within the Bojongsoang perimeter.<br>
          • <strong>Safety Protocols:</strong> Automated critical status detection and alerting.
        </p>
      </div>

      <button class="btn active" onclick="closeAbout()" style="width:100%; justify-content:center; padding:12px;">Close Information</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="dashboard.js"></script>
</body>
</html>
